PyGAAP is the Python port of JGAAP, Java Graphical Authorship Attribution Program by Patrick Juola et al.\
See https://evllabs.github.io/JGAAP/

# PyGAAP Developer Manual

# Table of contents
1. [Key differences from JGAAP](#key_differences)
2. [Widget structures](#structures)
   1. [Outline of tkinter widgets](#Outline_of_tkinter_widgets)
   2. [Function Calls](#nested_funcs)
3. [Adding a new module](#new_mod)
   1. [Classs variables](#class_variables)
   1. [Class initialization](#class_init)
   2. [Class functions](#class_functions)
   3. [Reload modules while PyGAAP is running](#live_reload)

# Key differences from JGAAP <a name="key-differences"></a>
## Module parameters
1. Unlike JGAAP, PyGAAP does not (currently) use dedicated classes for module parameters. See [Class variables](#class_variables).



# Widget structures <a name="structures"></a>
## Outline of tkinter widgets <a name="Outline_of_tkinter_widgets"></a>

```
name                                         description (Tkinter module used)

topwindow                                             name of main window (Tk)
├── menubar                                           name of top menu bar (Menu)
├── workspace                                         main Frame under topwindow that contains notebook Tabs (Frame)
│   ├── tabs                                          This sets up the tabs (Notebook)
│   │   ├── Tab_Documents                             Holds widgets in Documents tab (Frame)
│   │   │   ├── Tab_Documents_UnknownAuthors_Frame   Contains Listbox for unknown authors (Frame)
│   │   │   ├── Tab_Documents_doc_buttons            Buttons for unknown authors (Frame)
│   │   │   ├── Tab_Documents_KnownAuthors_Frame     Contains Listbox for unknown authors (Frame)
│   │   │   ├── Tab_Documents_knownauth_buttons      Buttons for known authors (Frame)
│   │   |
│   │   │      The 4 tabs below are generated by create_feature_tab(). The widgets in these tabs are saved in "objects".
│   │   ├── Tab_Canonicizers           Holds widgets in Canonicizers tab (Frame)           widgets in generated_widgets['Canonicizers']
│   │   ├── Tab_EventDrivers           Holds widgets in Event Drivers tab (Frame)          widgets in generated_widgets['EventDrivers']
│   │   ├── Tab_EventCulling           Same Setup as Event Drivers Tab                     widgets in generated_widgets['EventCulling']
│   │   ├── Tab_AnalysisMethods        Holds widgets in Analysis Methods tab (Frame)       widgets in generated_widgets['AnalysisMethods']
│   │   |
│   │   │      within the dictionary entry listed above as % the structure is as follows:
│   │   ├── %
│   │   │   ├── %["top_frame"]
│   │   │   │   ├── %["available_frame"]                Contains the listboxes where available features are displayed.
|   |   |   |   |   └── %["available_listboxes]       = [
|   |   |   |   |                                           [Frame, Label, Listbox, Scrollbar],
|   |   |   |   |                                           [Frame, Label, Listbox, Scrollbar] # for analysis methods (two listboxes to choose from)
|   |   |   |   |                                       ]
│   │   │   │   ├── %["buttons_frame"]                  Contains the add/remove/clear buttons.
│   │   │   │   ├── %["selected_frame"]                 Contains the listbox where selected features are displayed.
|   |   |   |   |   └── %["selected_listboxes]       = [Frame, Label, Lixtbox/Treeview, Scrollbar]
│   │   │   │   └── %["parameters_frame"]               Contains the frame where parameters of a feature are displayed.
│   │   │   |
│   │   │   ├── ["description_frame"]                Contains the text box where the description of a feature is displayed.
│   │   |
│   │   ├── Tab_ReviewProcess                      Holds widgets in Review & Process tab (Frame)
│   │   │   ├── Tab_ReviewProcess_Canonicizers       Contains corresponding listbox
│   │   │   ├── Tab_ReviewProcess_EventDrivers
│   │   │   ├── Tab_ReviewProcess_EventCulling
│   │   │   ├── Tab_ReviewProcess_AnalysisMethods
│   │   |
├── bottomframe                                Hold buttons at the bottom: Notes, Next, and Finish.
└── status_bar                                 Contains the label (text) for status.
```


## Map of some function calls <a name="nested_funcs"></a>
In the GUI code, set ```GUI_debug``` to ```3``` to see function calls printed to the terminal.
```
Notepad()
├── -# NotepadWindow_SaveButton
   ├── -NotepadWindow_SaveButton -> Notepad_Save(text)

authorsList(.., mode)                                 #called when a button in [Tab_Documents_knownauth_buttons] is pressed. The mode distinguishes the buttons.
├── -# AuthorAddDocButton
│    ├── -addFile()                                     # opens OS's file browser
|
├── -# AuthorRmvDocButton
│    ├── -select_features(..., "remove")
|
├── -#AuthorOKButton
   ├── -@ if mode=="add":                             # when "Add Author" button is pressed
   │    authorSave(..., "add")                        # updates global list (backend) of authors and their documents
   │    ├── -authorsListUpdater()                       # refreshes the listbox used to display authors
   |
   ├── -@ else if mode=="edit"                        # when "Edit Author" button is pressed
      authorSave(..., "edit")                       # updates global list (backend) of authors and their documents
      ├── -authorsListUpdater()                       # refreshes the listbox used to display authors
```


# Adding a new module <a name="new_mod"></a>
Each module is a class in or imported to the file containing modules of the same type. These types are canonicizers (```Canonicizer.py```), event drivers (```EventDriver.py```), event cullers (```EventCulling.py```), analysis methods (```AnalysisMethod.py```), and distance functions (```DistanceFunction.py```). Add package dependencies and their version numbers to ```./requirements.txt```, if applicable.

## <span style="color:#aaeeff">Class variables</span> <a name="class_variables"></a>
Class variables are declared within the class definition.

### <span style="color:#aaeeff">User parameters for Event Drivers, Event Culling and Analysis Methods
Each user parameter is a class variable exposed to the GUI. These variables must also have corresponding entries in ```_variable_options```, and their names cannot begin with a "```_```".
Conversely, to hide a class variable from the GUI, prefix the name with a "```_```".

- `_global_parameters` API parameters to be passed to all modules, like `language`.
- ```_variable_options``` (dictionary) lists the options, GUI type, and the default values of variables. The variables' names are the keys and their attributes are dicts. Each dict for a variable must have ```"options"``` for range of available choices, ```"type"``` for the GUI widget type (currently only ```OptionMenu``` is supported), and ```"default"``` for the default value _**as an index of the ```"options"``` list**_ (for the example below, the default corresponds to ```0```, which picks the item with ```0``` index in the ```"options"``` list as the default value, i.e. the default **value** is ```3```).\
Example:
```{"variable_1": {"options": list(range(3, 10)), "type": OptionMenu, "default": 0}}```


### <span style="color:#aaeeff">Class variables for Analysis Methods
- ```_NoDistanceFunction_``` (boolean) if an anlysis method does not allow a distance function to be set, add this and set it to ```True```. It's okay to omit this variable if it would be set to ```False```.
- ```_multiprocessing_score``` (integer) the "time-consumingness" of an analysis method. Default is 1 (or if omitted). The score for all analysis methods will be summed before processing to determine if multi-processing is needed. Set a higher score if a method usually takes particularly long.

## <span style="color:#aaeeff"> Class initialization</span> <a name="class_init"></a>
The `__init__()` method for module classes contains initialization for required parameters. These are handled in the abstract (base) class at the top of the generic module files (`~/generics/...`). If a separate init method is needed for a module, the init function for the abstract class should be called as well.

## <span style="color:#aaeeff"> Class functions</span> <a name="class_functions"></a>
- All modules are required to have ```displayName()``` and ```displayDescription()```.
   - ```displayName()``` (nothing → String) returns the name of the module. Note that the name of a distance function cannot be ```NA```, which is reserved for a place-holder for analysis methods that don't use distance functions.
   - ```displayDescription()``` (nothing → String) returns a description of the module.

> ❗ Make sure to **return** and not (just) print the names and descriptions.

Functions by types of module:
- Canonicizers:
   - ```process()``` (String → String) 
- Event drivers:
   - ```CreateEventSet()``` (String → List)
   - ```setParams()```
- Event cullers:
   - to be determined
- Analysis methods:
   - ```train()```
   - ```analyze()```
   - ```setDistanceFunction()``` (optional)

## <span style="color:#aaeeff"> Reload modules while PyGAAP is running</span> <a name="live_reload"></a>

To reload all modules while PyGAAP is running, switch to the ```Canonicizers``` tab, press the **right ctrl key**, and click ```Reload all modules``` that appears on the right.\
There will be a confirmation in the status bar or an error message window.
> ❗ Reloading will remove all selected modules.


# Abbreviations, Initialisms, and Acronyms
- CLI - Command line interface